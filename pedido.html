<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedido - Pastelaria do Fumaça</title>
<link rel="stylesheet" href="stylepedido.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <div class="menu-icon" id="menu-toggle">&#9776;</div>
  <ul class="menu" id="nav-menu">
    <li><a href="index.html">Início</a></li>
    <li><a href="pastel.html">Pastel</a></li>
    <li><a href="hamburguer.html">Hambúrguer</a></li>
    <li><a href="bebidas.html">Sucos e refrigerantes</a></li>
    <li><a href="acai.html">Açai e Milk-Shake</a></li> 
    <li><a href="pedido.html">Carrinho</a></li>
  </ul>
  <div class="title">Confira seu pedido</div>
</header>

<main>
  <section id="produto"></section>

  <section id="cliente-info">
    <h3>Informações do Cliente</h3>
    <label>Nome: <input type="text" id="nome"></label><br>
    <label>Endereço: <input type="text" id="endereco"></label><br>
    <label>Observações: <input type="text" id="observacoes"></label><br>
    <label>Pagamento:
      <select id="pagamento">
        <option value="">Selecione</option>
        <option value="dinheiro">Dinheiro</option>
        <option value="cartao">Cartão</option>
        <option value="pix">Pix</option>
      </select>
    </label>
    <div id="pix-info" class="hidden"></div>
    <br>
    <button id="enviar-vendedora-btn">Finalizar Pedido</button>
  </section>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const produtoDiv = document.getElementById('produto');
  const botaoVendedora = document.getElementById('enviar-vendedora-btn');
  const pagamentoSelect = document.getElementById('pagamento');
  const pixDiv = document.getElementById('pix-info');

  // Array de bairros e taxas
  const bairrosTaxas = [
    { bairro: "centro", taxa: 5.0 },
    { bairro: "jardim américa", taxa: 7.5 },
    { bairro: "vila nova", taxa: 6.0 }
  ];

  // Mostrar itens no carrinho
  function mostrarCarrinho() {
    const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
    produtoDiv.innerHTML = '';
    let total = 0;

    if(carrinho.length === 0) {
      produtoDiv.textContent = 'Nenhum item no pedido.';
      return;
    }

    carrinho.forEach((item, index) => {
      const itemDiv = document.createElement('div');
      itemDiv.classList.add('item-carrinho');

      const nome = item.nome || 'Produto sem nome';
      const preco = item.preco || 0;
      const adicionais = item.adicionais?.length ? ` + ${item.adicionais.join(', ')}` : '';

      const span = document.createElement('span');
      span.textContent = `${nome}${adicionais} - R$ ${preco.toFixed(2)}`;

      const btnRemover = document.createElement('button');
      btnRemover.textContent = 'Remover';
      btnRemover.addEventListener('click', () => removerItem(index));

      itemDiv.appendChild(span);
      itemDiv.appendChild(btnRemover);
      produtoDiv.appendChild(itemDiv);

      total += preco;
    });

    const pTotal = document.createElement('p');
    pTotal.innerHTML = `<strong>Total: R$ ${total.toFixed(2)}</strong>`;
    produtoDiv.appendChild(pTotal);
  }

  function removerItem(index) {
    const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
    carrinho.splice(index,1);
    localStorage.setItem('carrinho', JSON.stringify(carrinho));
    mostrarCarrinho();
  }

  // Controle Pix
  pagamentoSelect.addEventListener('change', () => {
    pixDiv.classList.toggle('hidden', pagamentoSelect.value !== 'pix');
    if(pagamentoSelect.value !== 'pix') pixDiv.innerHTML = '';
  });

  // Finalizar pedido
  botaoVendedora.addEventListener('click', finalizarPedido);

  function finalizarPedido() {
    const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
    if(carrinho.length === 0) { alert('Seu pedido está vazio!'); return; }

    const nomeCliente = document.getElementById('nome').value.trim();
    const enderecoCliente = document.getElementById('endereco').value.trim().toLowerCase();
    const observacoes = document.getElementById('observacoes').value.trim();
    const formaPagamento = pagamentoSelect.value;

    if(!nomeCliente || !enderecoCliente || !formaPagamento) {
      alert('Preencha nome, endereço e forma de pagamento!');
      return;
    }

    const bairroEncontrado = bairrosTaxas.find(({bairro}) => enderecoCliente.includes(bairro));
    if(!bairroEncontrado) { alert('Desculpe, não entregamos nesse bairro.'); return; }

    const taxaEntrega = bairroEncontrado.taxa;
    let mensagem = '📦 *Novo Pedido*\n\n';
    let total = 0;

    carrinho.forEach(({nome='Produto sem nome', preco=0, adicionais}) => {
      const adicionaisTexto = adicionais?.length ? ` + ${adicionais.join(', ')}` : '';
      mensagem += `• ${nome}${adicionaisTexto} - R$ ${preco.toFixed(2)}\n`;
      total += preco;
    });

    const totalComEntrega = total + taxaEntrega;
    mensagem += `\n🚚 *Taxa de entrega:* R$ ${taxaEntrega.toFixed(2)}\n`;
    mensagem += `💰 *Total com entrega:* R$ ${totalComEntrega.toFixed(2)}\n`;
    mensagem += `👤 *Cliente:* ${nomeCliente}\n`;
    mensagem += `🏠 *Endereço:* ${enderecoCliente}\n`;
    if(observacoes) mensagem += `📝 *Observações:* ${observacoes}\n`;
    mensagem += `💳 *Pagamento:* ${formaPagamento.toUpperCase()}\n`;
    mensagem += `🕒 Data: ${new Date().toLocaleString()}\n`;

    if(formaPagamento === 'pix') {
      mensagem += `\n📲 *Pagamento via Pix*\nChave Pix: 13988799046\nValor: R$ ${totalComEntrega.toFixed(2)}\nEnvie o comprovante após o pagamento. ✅\n`;
      pixDiv.classList.remove('hidden');
      pixDiv.innerHTML = `
        <p><strong>Chave Pix:</strong> 13988799046</p>
        <p><strong>Valor:</strong> R$ ${totalComEntrega.toFixed(2)}</p>
        <button id="btn-copiar-pix">Copiar chave Pix</button>
        <p>Após o pagamento, envie o comprovante pelo WhatsApp.</p>
      `;
      document.getElementById('btn-copiar-pix').addEventListener('click', () => {
        navigator.clipboard.writeText('13988799046').then(() => alert('Chave Pix copiada!'));
      });
    } else { pixDiv.classList.add('hidden'); pixDiv.innerHTML = ''; }

    const novoPedido = {
      itens: carrinho,
      cliente: nomeCliente,
      endereco: enderecoCliente,
      observacoes,
      pagamento: formaPagamento,
      data: new Date().toLocaleString(),
      status: 'Aguardando'
    };

    const pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
    pedidos.push(novoPedido);
    localStorage.setItem('pedidos', JSON.stringify(pedidos));

    localStorage.removeItem('carrinho');
    mostrarCarrinho();

    if(formaPagamento !== 'pix') {
      document.getElementById('nome').value='';
      document.getElementById('endereco').value='';
      document.getElementById('observacoes').value='';
      pagamentoSelect.value='';
    }

    const numero = '5513988799046';
    const link = `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`;
    window.open(link, '_blank');
  }

  mostrarCarrinho();

  // Menu mobile
  const menuToggle = document.getElementById("menu-toggle");
  const navMenu = document.getElementById("nav-menu");
  menuToggle.addEventListener("click", e => {
    e.stopPropagation();
    navMenu.classList.toggle("open");
  });
  document.addEventListener("click", e => {
    if(!navMenu.contains(e.target) && e.target !== menuToggle) navMenu.classList.remove("open");
  });
});
</script>

</body>
</html>